<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R48BYVFMH2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-R48BYVFMH2');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Test</title>
    <link href="/static/styles.css" rel="stylesheet">
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <div class="glass-effect rounded-2xl shadow-2xl p-8 border border-white/20">
            <h2 class="text-2xl font-semibold text-white mb-6 text-center">Login Test</h2>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white/90 mb-2">Username</label>
                    <input id="username" type="text" required 
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200" 
                           placeholder="Enter your username" value="admin">
                </div>
                <div>
                    <label class="block text-sm font-medium text-white/90 mb-2">Password</label>
                    <input id="password" type="password" required 
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent transition-all duration-200" 
                           placeholder="Enter your password" value="admin123">
                </div>
                <button type="submit" 
                        class="w-full bg-white text-indigo-600 font-semibold py-3 px-4 rounded-lg hover:bg-white/90 focus:outline-none focus:ring-2 focus:ring-white/30 transition-all duration-200">
                    Test Login
                </button>
            </form>
            
            <div id="result" class="mt-4 p-3 rounded-lg hidden"></div>
        </div>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const result = document.getElementById('result');
            
            console.log('Form submitted with:', { username, password });
            
            try {
                // Test the test endpoint first
                console.log('Testing test endpoint...');
                const testResponse = await fetch('/api/auth/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const testData = await testResponse.json();
                console.log('Test endpoint response:', testData);
                
                // Now try the actual login
                console.log('Trying login endpoint...');
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                console.log('Login response status:', loginResponse.status);
                console.log('Login response headers:', loginResponse.headers);
                
                if (loginResponse.ok) {
                    result.className = 'mt-4 p-3 rounded-lg bg-green-500/20 border border-green-500/30 text-green-200';
                    result.textContent = 'Login successful! Redirecting...';
                    result.classList.remove('hidden');
                    window.location.href = '/';
                } else {
                    const errorData = await loginResponse.json();
                    console.log('Login error:', errorData);
                    result.className = 'mt-4 p-3 rounded-lg bg-red-500/20 border border-red-500/30 text-red-200';
                    result.textContent = `Login failed: ${errorData.detail || 'Unknown error'}`;
                    result.classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                result.className = 'mt-4 p-3 rounded-lg bg-red-500/20 border border-red-500/30 text-red-200';
                result.textContent = `Error: ${error.message}`;
                result.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
